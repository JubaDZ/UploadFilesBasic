!function(a,b){"function"==typeof define&&define.amd?define(function(){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(a):a.ss=b(a)}("undefined"!=typeof window?window:this,function(a){var m,b=a.ss||{},c=/^\s+/,d=/\s+$/,e=/[xy]/g,f=/.*(\/|\\)/,g=/.*[.]/,h=/[\t\r\n]/g,i=Object.prototype.toString.call(a.HTMLElement).indexOf("Constructor")>0,j=-1!==navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("MSIE 1"),k=-1!==navigator.userAgent.indexOf("MSIE 7"),l=document.createElement("input");l.type="file",m="multiple"in l&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,b.obj2string=function(a,c){"use strict";var d=[];for(var e in a)if(a.hasOwnProperty(e)){var f=c?c+"["+e+"]":e,g=a[e];d.push("object"==typeof g?b.obj2string(g,f):encodeURIComponent(f)+"="+encodeURIComponent(g))}return d.join("&")},b.extendObj=function(a,b){"use strict";for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},b.addEvent=function(a,c,d){"use strict";return a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent("on"+c,d),function(){b.removeEvent(a,c,d)}},b.removeEvent=document.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;void 0===a[d]&&(a[d]=null),a.detachEvent(d,c)},b.newXHR=function(){"use strict";if("undefined"!=typeof XMLHttpRequest)return new a.XMLHttpRequest;if(a.ActiveXObject)try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}},b.encodeUTF8=function(a){"use strict";return unescape(encodeURIComponent(a))},b.getIFrame=function(){"use strict";var c,a=b.getUID();return k?c=document.createElement('<iframe src="javascript:false;" name="'+a+'">'):(c=document.createElement("iframe"),c.src="javascript:false;",c.name=a),c.style.display="none",c.id=a,c},b.getForm=function(a){"use strict";var b=document.createElement("form");b.encoding="multipart/form-data",b.enctype="multipart/form-data",b.style.display="none";for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},b.getHidden=function(a,b){"use strict";var c=document.createElement("input");return c.type="hidden",c.name=a,c.value=b,c},b.parseJSON=function(c){"use strict";if(!c)return!1;if(c=b.trim(c+""),a.JSON&&a.JSON.parse)try{return a.JSON.parse(c+"")}catch(a){return!1}var f,d=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,e=null;return!(!c||b.trim(c.replace(d,function(a,b,c,d){return f&&b&&(e=0),0===e?a:(f=c||b,e+=!d-!c,"")})))&&Function("return "+c)()},b.getBox=function(b){"use strict";var c,d,e=0,f=0;if(b.getBoundingClientRect)c=b.getBoundingClientRect(),d=document.documentElement,e=c.top+(a.pageYOffset||d.scrollTop)-(d.clientTop||0),f=c.left+(a.pageXOffset||d.scrollLeft)-(d.clientLeft||0);else do{f+=b.offsetLeft,e+=b.offsetTop}while(b=b.offsetParent);return{top:Math.round(e),left:Math.round(f)}},b.addStyles=function(a,b){"use strict";for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])},b.copyLayout=function(a,c){"use strict";var d=b.getBox(a);b.addStyles(c,{position:"absolute",left:d.left+"px",top:d.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},b.formatBytes=function(a,b){if("ar"===b)var c=["بايت","كيلو","ميقا","جيقا","تيرا"];else var c=["Bytes","KB","MB","GB","TB"];var d=1024,e=Math.floor(Math.log(a)/Math.log(d));return parseFloat((a/Math.pow(d,e)).toFixed(2))+" "+c[e+1]},b.getUID=function(){"use strict";return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})};var n="".trim;b.trim=n&&!n.call("\ufeff ")?function(a){return null===a?"":n.call(a)}:function(a){return null===a?"":a.toString().replace(c,"").replace(d,"")};var o=[];return b.indexOf=o.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},b.arrayDelete=function(a,c){var d=b.indexOf(a,c);d>-1&&a.splice(d,1)},b.getFilename=function(a){"use strict";return a.replace(f,"")},b.getExt=function(a){"use strict";return-1!==a.indexOf(".")?a.replace(g,""):""},b.isVisible=function(a){"use strict";return!!a&&(1!==a.nodeType||a==document.body?(a=null,!0):a.parentNode&&(a.offsetWidth>0||a.offsetHeight>0||"none"!=b.getStyle(a,"display").toLowerCase())?b.isVisible(a.parentNode):(a=null,!1))},b.getStyle=function(b,c){"use strict";if(a.getComputedStyle){return b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue(c)}if(b.currentStyle&&b.currentStyle[c])return b.currentStyle[c]},b.getFormObj=function(a){"use strict";for(var f,c=a.elements,d=["button","submit","image","reset"],e={},g=0,h=c.length;g<h;g++)if(f={},c[g].name&&!c[g].disabled&&-1===b.indexOf(d,c[g].type)){if(("checkbox"==c[g].type||"radio"==c[g].type)&&!c[g].checked)continue;f[c[g].name]=b.val(c[g]),b.extendObj(e,f)}return e},b.val=function(a){"use strict";if(a){if("SELECT"==a.nodeName.toUpperCase()){for(var f,b=a.options,c=a.selectedIndex,d="select-one"===a.type||c<0,e=d?null:[],g=0,h=b.length;g<h;g++)if((b[g].selected||g===c)&&!b[g].disabled){if(f=b[g].value?b[g].value:b[g].text,d)return f;e.push(f)}return e}return a.value}},b.hasClass=function(a,b){"use strict";return!(!a||!b)&&(" "+a.className+" ").replace(h," ").indexOf(" "+b+" ")>=0},b.addClass=function(a,c){"use strict";if(!a||!c)return!1;b.hasClass(a,c)||(a.className+=" "+c)},b.removeClass=function(){"use strict";var a={};return function(b,c){if(!b||!c)return!1;a[c]||(a[c]=new RegExp("(?:^|\\s)"+c+"(?!\\S)")),b.className=b.className.replace(a[c],"")}}(),b.purge=function(a){"use strict";var d,e,f,c=a.attributes;if(c)for(d=c.length-1;d>=0;d-=1)f=c[d].name,"function"==typeof a[f]&&(a[f]=null);if(c=a.childNodes)for(e=c.length,d=0;d<e;d+=1)b.purge(a.childNodes[d])},b.remove=function(a){"use strict";a&&a.parentNode&&(b.purge(a),a.parentNode.removeChild(a)),a=null},b.verifyElem=function(c){"use strict";return"undefined"!=typeof jQuery&&c instanceof jQuery?c=c[0]:"string"==typeof c&&("#"==c.charAt(0)&&(c=c.substr(1)),c=document.getElementById(c)),!(!c||1!==c.nodeType)&&("A"==c.nodeName.toUpperCase()&&(c.style.cursor="pointer",b.addEvent(c,"click",function(b){b&&b.preventDefault?b.preventDefault():a.event&&(a.event.returnValue=!1)})),c)},b._options={},b.uploadSetup=function(a){"use strict";b.extendObj(b._options,a)},b.SimpleUpload=function(a){"use strict";if(this._opts={button:"",url:"",dropzone:"",dragClass:"",form:"",overrideSubmit:!0,cors:!1,withCredentials:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,multipleSelect:!1,maxUploads:3,queue:!0,checkProgressInterval:500,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",customProgressHeaders:{},corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",lang:"en",data:{},noParams:!0,autoSubmit:!0,multipart:!0,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},encodeHeaders:!0,autoCalibrate:!0,onBlankSubmit:function(){},onAbort:function(a,b,c){},onChange:function(a,b,c,d,e){},onSubmit:function(a,b,c,d){},onProgress:function(a){},onUpdateFileSize:function(a){},onComplete:function(a,b,c,d){},onDone:function(a,b,c,d,e,f){},onAllDone:function(){},onExtError:function(a,b){},onSizeError:function(a,b){},onError:function(a,b,c,d,e,f,g){},startXHR:function(a,b,c){},endXHR:function(a,b,c){},startNonXHR:function(a,b){},endNonXHR:function(a,b){}},b.extendObj(this._opts,b._options),b.extendObj(this._opts,a),this._queue=[],this._active=0,this._disabled=!1,this._maxFails=10,this._progKeys={},this._sizeFlags={},this._btns=[],this.addButton(this._opts.button),delete this._opts.button,this._opts.button=a=null,!1===this._opts.multiple&&(this._opts.maxUploads=1),""!==this._opts.dropzone&&this.addDZ(this._opts.dropzone),""===this._opts.dropzone&&this._btns.length<1)throw new Error("Invalid upload button. Make sure the element you're passing exists.");""!==this._opts.form&&this.setForm(this._opts.form),this._createInput(),this._manDisabled=!1,this.enable(!0)},b.SimpleUpload.prototype={destroy:function(){"use strict";for(var a=this._btns.length;a--;)this._btns[a].off&&this._btns[a].off(),b.removeClass(this._btns[a],this._opts.hoverClass),b.removeClass(this._btns[a],this._opts.focusClass),b.removeClass(this._btns[a],this._opts.disabledClass),this._btns[a].disabled=!1;this._killInput(),this._destroy=!0},log:function(b){"use strict";this._opts&&this._opts.debug&&a.console&&a.console.log&&a.console.log("[Uploader] "+b)},setData:function(a){"use strict";this._opts.data=a},setOptions:function(a){"use strict";b.extendObj(this._opts,a)},addButton:function(a){var c;if(a instanceof Array)for(var d=0,e=a.length;d<e;d++)c=b.verifyElem(a[d]),!1!==c?this._btns.push(this.rerouteClicks(c)):this.log("Button with array index "+d+" is invalid");else!1!==(c=b.verifyElem(a))&&this._btns.push(this.rerouteClicks(c))},addDZ:function(a){m&&(a=b.verifyElem(a),a?this.addDropZone(a):this.log("Invalid or nonexistent element passed for drop zone"))},setProgressBar:function(a){"use strict";this._progBar=b.verifyElem(a)},setPctBox:function(a){"use strict";this._pctBox=b.verifyElem(a)},setFileSizeBox:function(a){"use strict";this._sizeBox=b.verifyElem(a)},setProgressContainer:function(a){"use strict";this._progBox=b.verifyElem(a)},setAbortBtn:function(a,c){"use strict";this._abortBtn=b.verifyElem(a),this._removeAbort=!1,c&&(this._removeAbort=!0)},setForm:function(c){"use strict";if(this._form=b.verifyElem(c),this._form&&"FORM"==this._form.nodeName.toUpperCase()){var d=this;this._opts.autoSubmit=!1,this._opts.overrideSubmit&&(b.addEvent(this._form,"submit",function(b){b.preventDefault?b.preventDefault():a.event&&(a.event.returnValue=!1),d._validateForm()&&d.submit()}),this._form.submit=function(){d._validateForm()&&d.submit()})}else this.log("Invalid or nonexistent element passed for form")},getQueueSize:function(){"use strict";return this._queue.length},removeCurrent:function(a){"use strict";if(a){for(var b=this._queue.length;b--;)if(this._queue[b].id===a){this._queue.splice(b,1);break}}else this._queue.splice(0,1);this._cycleQueue()},clearQueue:function(){"use strict";this._queue.length=0},disable:function(a){"use strict";var d,c=this._btns.length;for(this._manDisabled=!a||!0===this._manDisabled,this._disabled=!0;c--;)d=this._btns[c].nodeName.toUpperCase(),"INPUT"!=d&&"BUTTON"!=d||(this._btns[c].disabled=!0),""!==this._opts.disabledClass&&b.addClass(this._btns[c],this._opts.disabledClass);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(a){"use strict";if(a||(this._manDisabled=!1),!0!==this._manDisabled){var c=this._btns.length;for(this._disabled=!1;c--;)b.removeClass(this._btns[c],this._opts.disabledClass),this._btns[c].disabled=!1}},updatePosition:function(a){"use strict";a=a||this._btns[0],a&&this._input&&this._input.parentNode&&b.copyLayout(a,this._input.parentNode),a=null},rerouteClicks:function(c){"use strict";var e,f,d=this;if(e=b.addEvent(c,"mouseover",function(){d._disabled||(d._input||d._createInput(),d._overBtn=c,b.copyLayout(c,d._input.parentNode),d._input.parentNode.style.visibility="visible")}),f=b.addEvent(c,"click",function(a){a&&a.preventDefault&&a.preventDefault(),d._disabled||(d._input||d._createInput(),d._overBtn=c,j||d._input.click())}),c.off=function(){e(),f()},d._opts.autoCalibrate&&!b.isVisible(c)){d.log("Upload button not visible");var g=function(){b.isVisible(c)?(d.log("Upload button now visible"),a.setTimeout(function(){d.updatePosition(c),1===d._btns.length&&(d._input.parentNode.style.visibility="hidden")},200)):a.setTimeout(g,500)};a.setTimeout(g,500)}return c},submit:function(a,b){"use strict";if(!b&&this._queue.length<1)return void this._opts.onBlankSubmit.call(this);if(!(this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1)&&this._checkFile(this._queue[0])){if(!1===this._opts.onSubmit.call(this,this._queue[0].name,this._queue[0].ext,this._queue[0].btn,this._queue[0].size))return void this.removeCurrent(this._queue[0].id);this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(!0),this._initUpload(this._queue[0])}}},b.IframeUpload={_detachEvents:{},_detach:function(a){this._detachEvents[a]&&(this._detachEvents[a](),delete this._detachEvents[a])},_getHost:function(a){var b=document.createElement("a");return b.href=a,b.hostname?b.hostname.toLowerCase():a},_addFiles:function(a){var c=b.getFilename(a.value),d=b.getExt(c);return!1!==this._opts.onChange.call(this,c,d,this._overBtn,void 0,a)&&(this._queue.push({id:b.getUID(),file:a,name:c,ext:d,btn:this._overBtn,size:null}),!0)},_uploadIframe:function(c,d,e,f,g,h,i){"use strict";var n,o,r,j=this,k=this._opts,l=b.getUID(),m=b.getIFrame(),p=!1,q=!1;if(o=!0===k.noParams?k.url:k.nginxProgressUrl?o+(o.indexOf("?")>-1?"&":"?")+encodeURIComponent(k.nginxProgressHeader)+"="+encodeURIComponent(l):k.url,n=b.getForm({action:o,target:m.name,method:k.method}),k.onProgress.call(this,0),g&&(g.innerHTML="0%"),f&&(f.style.width="0%",f.innerHTML="0%"),k.cors){var s=b.getUID();j._detachEvents[s]=b.addEvent(a,"message",function(a){if(j._getHost(a.origin)!=j._getHost(k.url))return void j.log("Non-matching origin: "+a.origin);p=!0,j._detach(s),k.endNonXHR.call(j,c.name,c.btn),j._finish(c,"","",a.data,e,d,g,h,i)})}j._detachEvents[m.id]=b.addEvent(m,"load",function(){j._detach(m.id),k.sessionProgressUrl?n.appendChild(b.getHidden(k.sessionProgressName,l)):k.progressUrl&&n.appendChild(b.getHidden(k.keyParamName,l)),j._form&&b.extendObj(k.data,b.getFormObj(j._form));for(var o in k.data)k.data.hasOwnProperty(o)&&n.appendChild(b.getHidden(o,k.data[o]));k.cors&&n.appendChild(b.getHidden(k.corsInputName,a.location.href)),n.appendChild(c.file),j._detachEvents[c.id]=b.addEvent(m,"load",function(){if(m&&m.parentNode&&!q)if(j._detach(c.id),q=!0,delete j._progKeys[l],delete j._sizeFlags[l],h&&b.removeEvent(h,"click",r),k.cors)a.setTimeout(function(){b.remove(m),p||j._errorFinish(c,"","",!1,"error",d,e,g,h,i),k=l=m=e=d=g=h=i=null},600);else{try{var f=m.contentDocument?m.contentDocument:m.contentWindow.document,n=f.body.innerHTML;b.remove(m),m=null,k.endNonXHR.call(j,c.name,c.btn),j._finish(c,"","",n,e,d,g,h,i)}catch(a){j._errorFinish(c,"",a.message,!1,"error",d,e,g,h,i)}k=l=e=d=g=null}}),h&&(r=function(){if(b.removeEvent(h,"click",r),delete j._progKeys[l],delete j._sizeFlags[l],m){q=!0,j._detach(c.id);try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(a){}try{m.src="javascript".concat(":false;")}catch(a){}a.setTimeout(function(){b.remove(m),m=null},1)}j.log("Upload aborted"),k.onAbort.call(j,c.name,c.btn,c.size),j._last(e,d,g,h,i,c,"abort")},b.addEvent(h,"click",r)),j.log("Commencing upload using iframe"),n.submit(),a.setTimeout(function(){b.remove(n),n=null,j.removeCurrent(c.id)},1),j._hasProgUrl&&(j._progKeys[l]=1,a.setTimeout(function(){j._getProg(l,f,e,g,1),f=e=g=null},600))}),document.body.appendChild(n),document.body.appendChild(m)},_getProg:function(c,d,e,f,g){"use strict";var k,l,m,h=this,i=this._opts,j=(new Date).getTime();if(c&&i)if(i.nginxProgressUrl?l=i.nginxProgressUrl+"?"+encodeURIComponent(i.nginxProgressHeader)+"="+encodeURIComponent(c)+"&_="+j:i.sessionProgressUrl?l=i.sessionProgressUrl:i.progressUrl&&(l=i.progressUrl+"?progresskey="+encodeURIComponent(c)+"&_="+j),m=function(){var j,l,n,o,p;try{if(m&&(i.cors||4===k.readyState)){m=void 0,k.onreadystatechange=function(){};try{p=k.statusText,o=k.status}catch(a){p="",o=""}if(i.cors||o>=200&&o<300){if(!1===(j=b.parseJSON(k.responseText)))return void h.log("Error parsing progress response (expecting JSON)");if(i.nginxProgressUrl){if("uploading"==j.state)(l=parseInt(j.size,10))>0&&(n=Math.round(parseInt(j.received,10)/l*100),l=Math.round(l));else if("done"==j.state)n=100;else if("error"==j.state)return void h.log("Error requesting upload progress: "+j.status)}else(i.sessionProgressUrl||i.progressUrl)&&!0===j.success&&(l=parseInt(j.size,10),n=parseInt(j.pct,10));if(n&&(f&&(f.innerHTML=n+"%"),d&&(d.style.width=n+"%",d.innerHTML=n+"%"),i.onProgress.call(h,n)),l&&!h._sizeFlags[c]&&(e&&(e.innerHTML=b.formatBytes(l,this._opts.lang)),h._sizeFlags[c]=1,i.onUpdateFileSize.call(h,l)),!n&&!l&&g>=h._maxFails)return g++,void h.log("Failed progress request limit reached. Count: "+g);n<100&&h._progKeys[c]&&a.setTimeout(function(){h._getProg(c,d,e,f,g),c=d=e=f=g=null},i.checkProgressInterval)}else delete h._progKeys[c],h.log("Error requesting upload progress: "+o+" "+p);k=l=n=o=p=j=null}}catch(a){h.log("Error requesting upload progress: "+a.message)}},i.cors&&!i.sessionProgressUrl){if(!a.XDomainRequest)return;k=new a.XDomainRequest,k.open("GET",l,!0),k.onprogress=k.ontimeout=function(){},k.onload=m,k.onerror=function(){delete h._progKeys[c],c=null,h.log("Error requesting upload progress")}}else{var p,n=i.sessionProgressUrl?"POST":"GET",o={};k=b.newXHR(),k.onreadystatechange=m,k.open(n,l,!0),i.sessionProgressUrl&&(p=encodeURIComponent(i.sessionProgressName)+"="+encodeURIComponent(c),o["Content-Type"]="application/x-www-form-urlencoded"),i.nginxProgressUrl&&(o[i.nginxProgressHeader]=c),o["X-Requested-With"]="XMLHttpRequest",o.Accept="application/json, text/javascript, */*; q=0.01",b.extendObj(o,i.customProgressHeaders);for(var q in o)o.hasOwnProperty(q)&&(i.encodeHeaders?k.setRequestHeader(q,b.encodeUTF8(o[q]+"")):k.setRequestHeader(q,o[q]+""));k.send(i.sessionProgressUrl&&p||null)}},_initUpload:function(a){if(!1===this._opts.startNonXHR.call(this,a.name,a.btn))return this._disabled&&this.enable(!0),void this._active--;this._hasProgUrl=!!(this._opts.progressUrl||this._opts.sessionProgressUrl||this._opts.nginxProgressUrl),this._uploadIframe(a,this._progBox,this._sizeBox,this._progBar,this._pctBox,this._abortBtn,this._removeAbort),a=this._progBox=this._sizeBox=this._progBar=this._pctBox=this._abortBtn=this._removeAbort=null}},b.XhrUpload={_addFiles:function(a){var d,e,f,g,c=a.length;for(this._opts.multiple||(c=1),g=0;g<c;g++){if(d=b.getFilename(a[g].name),e=b.getExt(d),f=Math.round(a[g].size/1024),!1===this._opts.onChange.call(this,d,e,this._overBtn,f,a[g]))return!1;this._queue.push({id:b.getUID(),file:a[g],name:d,ext:e,btn:this._overBtn,size:f})}return!0},_uploadXhr:function(a,c,d,e,f,g,h,i,j,k){"use strict";var o,p,l=this,m=this._opts,n=b.newXHR();f&&(f.innerHTML=b.formatBytes(a.size,this._opts.lang)),i&&(i.innerHTML="0%"),g&&(g.style.width="0%",g.innerHTML="0%"),o=function(c,d){var e;try{if(o&&(d||4===n.readyState))if(o=void 0,n.onreadystatechange=function(){},d)4!==n.readyState&&n.abort(),m.onAbort.call(l,a.name,a.btn,a.size),l._last(f,h,i,j,k,a,"abort");else{j&&b.removeEvent(j,"click",p);try{e=n.statusText}catch(a){e=""}n.status>=200&&n.status<300?(m.endXHR.call(l,a.name,a.size,a.btn),l._finish(a,n.status,e,n.responseText,f,h,i,j,k)):l._errorFinish(a,n.status,e,n.responseText,"error",h,f,i,j,k)}}catch(b){d||l._errorFinish(a,-1,b.message,!1,"error",h,f,i,j,k)}},j&&(p=function(){b.removeEvent(j,"click",p),o&&o(void 0,!0)},b.addEvent(j,"click",p)),n.onreadystatechange=o,n.open(m.method.toUpperCase(),c,!0),n.withCredentials=!!m.withCredentials,b.extendObj(e,m.customHeaders);for(var q in e)e.hasOwnProperty(q)&&(m.encodeHeaders?n.setRequestHeader(q,b.encodeUTF8(e[q]+"")):n.setRequestHeader(q,e[q]+""));if(b.addEvent(n.upload,"progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100);m.onProgress.call(l,b),i&&(i.innerHTML=b+"%"),g&&(g.style.width=b+"%",g.innerHTML=b+"%")}}),m.onProgress.call(this,0),!0===m.multipart){var r=new FormData,s=!1;for(var t in d)d.hasOwnProperty(t)&&(t!==m.name||!0!==m.noParams||l._form||(s=!0),r.append(t,d[t]));s||r.append(m.name,a.file),this.log("Commencing upload using multipart form"),n.send(r)}else this.log("Commencing upload using binary stream"),n.send(a.file);this.removeCurrent(a.id)},_initUpload:function(a){"use strict";var e,c={},d={};if(!1===this._opts.startXHR.call(this,a.name,a.size,a.btn))return this._disabled&&this.enable(!0),void this._active--;d["X-Requested-With"]="XMLHttpRequest",d["X-File-Name"]=b.encodeUTF8(a.name),"json"==this._opts.responseType.toLowerCase()&&(d.Accept="application/json, text/javascript, */*; q=0.01"),this._opts.multipart||(d["Content-Type"]="application/octet-stream"),this._form&&b.extendObj(c,b.getFormObj(this._form)),b.extendObj(c,this._opts.data),e=!0===this._opts.noParams?this._opts.url:this._opts.url+(this._opts.url.indexOf("?")>-1?"&":"?")+b.obj2string(c),this._uploadXhr(a,e,c,d,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort),this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}},b.DragAndDrop={_dragFileCheck:function(a){if(a.dataTransfer.types)for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b])return!0;return!1},addDropZone:function(a){var c=this,d=[];b.addStyles(a,{zIndex:16777271}),a.ondragenter=function(a){return a.stopPropagation(),a.preventDefault(),!!c._dragFileCheck(a)&&(0===d.length&&b.addClass(this,c._opts.dragClass),-1===b.indexOf(d,a.target)&&d.push(a.target),!1)},a.ondragover=function(a){return a.stopPropagation(),a.preventDefault(),c._dragFileCheck(a)&&(a.dataTransfer.dropEffect="copy"),!1},a.ondragend=function(){return b.removeClass(this,c._opts.dragClass),!1},a.ondragleave=function(a){return b.arrayDelete(d,a.target),0===d.length&&b.removeClass(this,c._opts.dragClass),!1},a.ondrop=function(a){a.stopPropagation(),a.preventDefault(),b.arrayDelete(d,a.target),0===d.length&&b.removeClass(this,c._opts.dragClass),c._dragFileCheck(a)&&!1!==c._addFiles(a.dataTransfer.files)&&c._cycleQueue()}}},b.extendObj(b.SimpleUpload.prototype,{_createInput:function(){"use strict";var a=this,c=document.createElement("div");this._input=document.createElement("input"),this._input.type="file",this._input.name=this._opts.name,m&&!i&&this._opts.multipleSelect&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),b.addStyles(c,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:16777270}),"0"!==c.style.opacity&&(c.style.filter="alpha(opacity=0)"),b.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer",height:"100%",zIndex:16777270}),this._input.turnOff=b.addEvent(this._input,"change",function(){a._input&&""!==a._input.value&&!1!==a._addFiles(m?a._input.files:a._input)&&(b.removeClass(a._overBtn,a._opts.hoverClass),b.removeClass(a._overBtn,a._opts.focusClass),a._killInput(),a._createInput(),a._opts.autoSubmit&&a.submit())}),""!==a._opts.hoverClass&&(c.mouseOverOff=b.addEvent(c,"mouseover",function(){b.addClass(a._overBtn,a._opts.hoverClass)})),c.mouseOutOff=b.addEvent(c,"mouseout",function(){a._input.parentNode.style.visibility="hidden",""!==a._opts.hoverClass&&(b.removeClass(a._overBtn,a._opts.hoverClass),b.removeClass(a._overBtn,a._opts.focusClass))}),""!==a._opts.focusClass&&(this._input.focusOff=b.addEvent(this._input,"focus",function(){b.addClass(a._overBtn,a._opts.focusClass)}),this._input.blurOff=b.addEvent(this._input,"blur",function(){b.removeClass(a._overBtn,a._opts.focusClass)})),c.appendChild(this._input),document.body.appendChild(c),c=null},_last:function(a,c,d,e,f,g,h,i,j){"use strict";if(a&&(a.innerHTML=""),d&&(d.innerHTML=""),e&&f&&b.remove(e),c&&b.remove(c),this._active--,a=c=d=e=f=null,this._disabled&&this.enable(!0),this._destroy&&0===this._queue.length&&0===this._active)for(var k in this)this.hasOwnProperty(k)&&delete this[k];else this._opts.onDone.call(this,g.name,i,h,j,g.btn,g.size),this._cycleQueue(),0===this._queue.length&&0===this._active&&this._opts.onAllDone.call(this);g=h=i=j=null},_errorFinish:function(a,b,c,d,e,f,g,h,i,j){"use strict";this.log("Upload failed: "+b+" "+c),this._opts.onError.call(this,a.name,e,b,c,d,a.btn,a.size),this._last(g,f,h,i,j,a,"error",b,d),c=e=g=f=h=i=j=null},_finish:function(a,c,d,e,f,g,h,i,j){"use strict";if(this.log("Server response: "+e),"json"==this._opts.responseType.toLowerCase()&&!1===(e=b.parseJSON(e)))return void this._errorFinish(a,c,d,!1,"parseerror",g,f,i,j);this._opts.onComplete.call(this,a.name,e,a.btn,a.size),this._last(f,g,h,i,j,a,"success",c,e),d=f=g=h=i=j=null},_checkFile:function(a){"use strict";var b=!1,c=this._opts.allowedExtensions.length;if(c>0){for(;c--;)if(this._opts.allowedExtensions[c].toLowerCase()==a.ext.toLowerCase()){b=!0;break}if(!b)return this.removeCurrent(a.id),this.log("File extension not permitted"),this._opts.onExtError.call(this,a.name,a.ext),!1}return a.size&&!1!==this._opts.maxSize&&a.size>this._opts.maxSize?(this.removeCurrent(a.id),this.log(a.name+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,a.name,a.size),!1):(a=null,!0)},_killInput:function(){"use strict";this._input&&(this._input.turnOff&&this._input.turnOff(),this._input.focusOff&&this._input.focusOff(),this._input.blurOff&&this._input.blurOff(),this._input.parentNode.mouseOverOff&&this._input.parentNode.mouseOverOff(),b.remove(this._input.parentNode),delete this._input,this._input=null)},_cycleQueue:function(){"use strict";this._queue.length>0&&this._opts.autoSubmit&&this.submit(void 0,!0)},_validateForm:function(){"use strict";return!(this._form.checkValidity&&!this._form.checkValidity())}}),m?b.extendObj(b.SimpleUpload.prototype,b.XhrUpload):b.extendObj(b.SimpleUpload.prototype,b.IframeUpload),b.extendObj(b.SimpleUpload.prototype,b.DragAndDrop),b});