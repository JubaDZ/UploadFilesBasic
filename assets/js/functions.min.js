/*! Functions v0.9.6| (c) 2013-2018 onexite and other contributors | MIT license */
if ((!window.File || !window.FileReader || !window.FileList || !window.Blob) && IsGetEmpty && (!IsClose) && UpdateBrowser) {
	bootbox.alert({message:BrowserUpd , buttons: {ok: {label: _Yes}} });

}

if(siteurl!==_path_ && (!IsClose) && DirectoryChanged)
{
	bootbox.alert({message:UrlChanged, buttons: {ok: {label: _Yes}} });
}

if (IsClose) {

    $('title').html(TitleClsMsg);
    $('#SiteCloseModal').modal('show');
    $('#SiteCloseModal').on('hidden.bs.modal', function() {
        $('#SiteCloseModal').modal('show');
    });
	$("#container").remove();
    $("#menu").remove();
	$("#total_stats").remove();
    $("#myFooter").remove();
	$("#logo").remove();
	$("#navbar").remove();
	$(".se-pre-con").fadeOut("slow",function() {$(".se-pre-con").remove();});	
}

function getJsonFromString(json)
{
	var str = JSON.stringify(json); //json.toString();
	var start = str.indexOf('{');
	var end = str.indexOf('}');
	str = str.substring(start, end);
	str.replace(/&quot;/ig,'"');
	//str = JSON.parse('['+str+']');
	return (str); 
}

$(window).load(function() {
	if (!IsClose) {
		// Animate loader off screen

		$(".se-pre-con").fadeOut("slow",function() {
			
			$("#button-selection").hide(); 
			$("#result-selection").hide(); 
			
			$(".se-pre-con").remove();
			$("#navbar").css("visibility", "visible");
			$("#logo").css("visibility", "visible");
			$("#menu").css("visibility", "visible");
			$("#container").css("visibility", "visible");
			if ( $( "#total_stats" ).length )
			$("#total_stats").css("visibility", "visible");
			$("#myFooter").css("visibility", "visible");
		    

		 if ( $( "#wrap" ).length )$('#wrap').hide();
		 if ( $( "#upresult" ).length )$('#upresult').hide();
		 });
		 
	}
	});
	
$(document).ready(function() {
	/*$('#UploadFileModal').modal('show');*/
	// Javascript to enable link to tab
	var url = document.location.toString();
	if (url.match('#')) {
		$('.nav-tabs a[href="#'+url.split('#')[1]+'"]').tab('show') ;
	} 
	if (url.match('profile')) {
		//
	} 
	  if (document.getElementById("user-count")) {
        getStats(); 
        setInterval("updateStats()",3000);
    }
});

function showError(msg)
{
	return '<li class="list-group-item list-group-item-danger"><span class="badge alert-danger hidden-xs">' + ErrorMsg + '</span>' + msg  + '.</li>'
}
// Update new values on change
function updateStats() {
    userCount.update(userCount.startVal + 1);   
    fileCount.update(fileCount.startVal + 2);   
    downloadCount.update(downloadCount.startVal + 15);        
}

// Init countUp and set base values
function getStats() {
    $.ajax({ url : "ajax/index.php?total_stats"}).done(function(data) {
        if (typeof data !== 'undefined' && data != '') {
           // var data = JSON.parse(data);
            userCount = new CountUp("user-count", data.users -1, data.users, 0, 2);
            userCount.start();

            fileCount = new CountUp("file-count", data.files -3, data.files, 0, 10);
            fileCount.start();   

            downloadCount = new CountUp("download-count", data.downloads -10, data.downloads, 0, 50);
            downloadCount.start();       
            
        }                       
    });
}


function GetStatsDates() {
    $.ajax({ url : "ajax/index.php?stats_dates"}).done(function(data) {
        if (typeof data !== 'undefined' && data != '') {       
            lineChart("#ChartDates",data.labels,data.data,DateLbl);	
        }                       
    });
}




$('#StatsModal').on('hidden.bs.modal', function() {
        $("#ChartPlatforms").remove();
		$("#ChartCountries").remove();
		$("#ChartBrowsers").remove();
		$("#ChartReferrers").remove();
		$("#ChartDates").remove();	
    });
	
function ShowMessage(Message)
{
	
$("#upresult").show();
$('#wrap').show();	
$('#progressWrap').show() ;
$("#msgBox").append(showError( Message ));
(IsStatsPanel) ? $("#StatsPanel").html('') : '';	

}

function UploadOnComplete( )
{
	     
			//if (("#upresult").is(':hidden'))
			$("#upresult").show();
		
		   // if (("#wrap").is(':hidden'))
			$('#wrap').show();
			
	        $('#uploadIcon').html('<i class="icon-upload-cloud uploadIcon"></i>');
			$('#uploadLabel').html( ChooseOMsg );
			
			$('#dragLabel').show();
			$('#dragLabel').html( DragMsg );
			
			
			$("#queue").html( '' );
            $("#dropzone").attr('class', 'upload-drop-zone');	
		
			//$('#uploadLabel').show(); 
					
}


function GenerateCaptcha(_background_,_Font_ ) {
	
	if (typeof(_background_)==='undefined') _background_ = WellColor ;
	if (typeof(_Font_)==='undefined') _Font_ = FontColor ;
	//_background_ = typeof _background_ !== 'undefined' ? _background_ : WellColor;
	_captcha_ = 'ajax/index.php?captcha&background='+_background_+'&font='+_Font_ + Math.random();
	if ( $( "#captcha_1" ).length )
		$('#captcha_1').attr('src', _captcha_);
	if ( $( "#captcha_2" ).length )
		$('#captcha_2').attr('src', _captcha_);
	if ( $( "#captcha_3" ).length )
		$('#captcha_3').attr('src', _captcha_);
	if ( $( "#captcha_4" ).length )
		$('#captcha_4').attr('src', _captcha_);
	if ( $( "#captcha_5" ).length )
		$('#captcha_5').attr('src', _captcha_);
	if ( $( "#captcha_6" ).length )
		$('#captcha_6').attr('src', _captcha_);
}

function copyright()
{
var _Copyright = 'onexite',
	_Emailright= _Copyright+'@'+'gmail'+'.'+'com',
	_footer    = $('#footerTxt').html(),
	_author    = $('#author').attr('content'), 
	_IsAbout   = $( "#WellCopyright" ).length ? true : false;

		_about =  ( $( "#aboutCopyright" ).length ) ? $('#aboutCopyright').html() : _Copyright;
		_email =  ( $( "#emailCopyright" ).length ) ? $('#emailCopyright').html() : _Emailright;

	if( _footer.indexOf(_Copyright) == -1 || _about.indexOf(_Copyright) == -1 || _author.indexOf(_Copyright) == -1 || _email.indexOf(_Copyright) == -1 || FooterTxt.indexOf(_Copyright) == -1){
		bootbox.alert({ size: "small",title: "تنبيه",message:'لا يمكن تغيير حقوق المبرمج ، سيستمر هذا التنبيه في الظهور' , buttons: {ok: {label: _Yes}} });
		
		$('#footerTxt').html((FooterTxt.indexOf(_Copyright) == -1) ? _Copyright : FooterTxt);
		$('#author').attr('content',_Copyright);
		if ( $( "#aboutCopyright" ).length )
			$('#aboutCopyright').html(_Copyright);
		if ( $( "#emailCopyright" ).length )
			$('#emailCopyright').html(_Emailright);
  }
}

function FileInfoModal(id) { 

var FileInfo= $('#fileInfo_'+id).data() ;
	    
	    orgfilename = FileInfo["orgfilename"],
	    filename    = FileInfo["filename"],
	    deleteid    = FileInfo["deletehash"],
	    downloadurl = FileInfo['downurl'],
		downtotal   = FileInfo['downtotal'],
		filesize    = FileInfo['size'],
		filedate    = FileInfo['date'],
	    fileId      = FileInfo['fileid'],
		thumbnaildir= FileInfo['thumbnaildir'],
		cryptid     = FileInfo['cryptid'],
		folder      = FileInfo['folder'],
		numrows     = FileInfo['numrows'];
		
        _filename_  = (IsOrgFilename) ? "'"+orgfilename+"'" : "'"+filename+"'";
		
	FilesTotal = numrows ;	
    
	$('#tablefiles tr').removeClass();
	$('#file_'+fileId).removeClass().addClass('active');

    $('#FileId').val(id);
	$('#thumbnail').hide();
	$('#FileUrl').val(_path_+downloadurl);

	$('#FileInfosModal').modal('show');	
	$('#fileInfo_filename').html('--');

	$('#fileInfo_date').html('--');	
	$('#fileInfo_downcount').html('--');	
	$('#fileInfo_size').html('--');	
	$('#fileInfo_delete').html('--');
	$('#fileInfo_urldownload').html('--');
	$('#fileInfo_folder').html('--');
	$("#FileInfosResults").html('<code>'+PleaseWait+'</code>'); 

		$("#FileInfosResults").html("<code>"+id+" / "+numrows+"</code>"); 	
		$('#fileInfo_date').html(filedate);	
		$('#fileInfo_downcount').html(downtotal);	
		$('#fileInfo_size').html(filesize);	
		$('#fileInfo_folder').html(folder);
		
		if(IsDirect)
			$('#fileInfo_filename').html('<a href="'+_path_ +folder+'/'+filename+'"  target="_blank" >'+orgfilename+'</a>');
		else
			$('#fileInfo_filename').html(orgfilename);
	
		$('#fileInfo_delete').html('<i class="glyphicon glyphicon-remove"></i> <a href="javascript:void(0)" onclick="deleteFile('+fileId+','+deleteid+',1,'+_filename_+');" >'+deleteLabel+'</a>');
		$('#fileInfo_urldownload').html('<div class="dropup">'+
		'<a href="javascript:void(0)" data-toggle="dropdown"><i class="glyphicon glyphicon-link"></i> '+ActionLabel+
		' <span class="caret"></span></button>'+
		'<ul class="dropdown-menu">'+
		  '<li> <a href="./?download='+cryptid+'" target="_blank"><i class="glyphicon glyphicon-download-alt"></i> '+DownLoadMsg+'</a></li>'+
		  '<li> <a href="javascript:void(0)" onclick="CopyHideElmLink('+"'FileUrl'"+')"><i class="glyphicon glyphicon-copy"></i> '+CopyLabel+'</a></li>'+
		'</ul></div>');	
		
		
		if(thumbnaildir !=='')
		{
			 $('#fileInfo_thumbnail').attr('src', LoadingUrl);
			 $('#thumbnail').show();
			 setTimeout(function(){ $('#fileInfo_thumbnail').attr("src", _path_ + thumbnaildir); }, 200);	
		}
		else
			$('#fileInfo_thumbnail').attr('src', 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7');
		
		
		

}


function ShowLinks( FileNum ) {
	
	//alert(FilesTotal);
	var FileInfo= $('#file_'+FileNum).data() ; //$('#msgBox').find('#file_'+FileNum).data() ; fileNum
	
	    orgfilename = FileInfo["fileOrgname"],
	    filename    = FileInfo["fileName"],
	    deleteid    = FileInfo["fileDeleteid"],
	    downloadId  = FileInfo['fileDownloadid'],
	    id          = FileInfo['fileId'],
		thumbnaildir= FileInfo['fileThumbnaildir'],
		cryptid     = FileInfo['fileCryptid'],

		deleteUrl   = _path_ + '/index.php?delete=' + deleteid + '&id=' + cryptid,
        fileUrl     = _path_ + '/index.php?download=' + cryptid,
	    downloadUrl = _path_ + '/index.php?unq=' + downloadId + '&file=' + cryptid,
		viewUrl     = _path_ + '/index.php?view=' + cryptid,
        directUrl   = _path_ + escapeTags(filename),
		thumbnailUrl= _path_ + escapeTags(thumbnaildir);

		
      //alert(JSON.stringify(   $('#file_'+FileNum).data()         ));

    DisablingButton(FileNum,FilesTotal);
    $('#FileId').val(FileNum);
    $("#label_url").html('<a target="_blank" href="' + fileUrl + '">' + UrlMsg + '</a>');
	
    $('#url').val(fileUrl);
	
	if(thumbnaildir !== '' && IsThumbnail)
	{
		$('#thumbnail').attr('src', LoadingUrl);
		$("#thumbnail_url").html('<a target="_blank" href="' + thumbnailUrl + '">' + UrlthumMsg + '</a>');
		setTimeout(function(){ $('#thumbnail').attr("src", thumbnailUrl); }, 200);	
		$('#thumbnail_tr').show();	
	}
	else
	{
		$("#thumbnail_url").html('');
		$('#thumbnail').attr('src', 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7');
		$('#thumbnail_tr').hide();		
	}
	

	if (IsLogin && thumbnaildir !== '' && IsOutputImage) 
	{
		$("#label_view").html('<a target="_blank" href="' + viewUrl + '">' + UrlViewMsg + '</a>');
		$('#view').val(viewUrl);
		$('#view_tr').show();
	} 
	else
	{
		$('#view_tr').hide();
	}

    $("#label_downloadlink").html('<a target="_blank" href="' + downloadUrl + '">' + DownLoadMsg + '</a>');
    $('#downloadlink').val(downloadUrl);

	
    $("#FileNum").html('<code>'+FileNum+' / '+FilesTotal+'</code>'); 	  
    $("#FileNumMobile").html('<code>'+FileNum+' / '+FilesTotal+'</code>');
	
	 if(IsDirect)
	 {
		  $("#label_directlink").html('<a target="_blank" href="'+directUrl+'">'+UrlDrktMsg+'</a>'); 
		  $('#directlink').val(directUrl);	
	 }
	 
	 if(IsDeleteLink)
	 {
		 $("#label_delete").html('<a target="_blank" href="' + deleteUrl + '">' + UrlDeltMsg + '</a>');
		 $('#delete').val(deleteUrl); 
	 }
	 
    $("#FileOrgName").html(orgfilename);
    $('#ShowLinks').modal('show');
	

}


function request(parameter, ResultsID, formID) {
    var results = $("#" + ResultsID);
    results.html("<div class='alert alert-info'><i class='icon-spin4 animate-spin'></i> " + PleaseWait + "</div>");
    $.ajax({
        type: "POST",
        url: 'ajax/index.php?'+parameter,
        dataType: "json",
        data: $("#" + formID).serialize(),
        success: function(data) {
            if (data['success_msg']) {
                results.html(data['success_msg']);
                if (formID == 'register_form' || formID == 'login_form') {
                     (data['admin_msg']) ? setInterval(redirect('admin'), 1000) : setInterval(redirect('./'), 1000);
                }
				
                if (formID == 'register_form' || formID == 'contact_form') {
                    $("#" + formID).trigger("reset");    
					setInterval(redirect('./'), 3000);
                } else if(formID=='profile_form')
					location.reload();
				else if(formID=='add_comment_form')
				{
					$("#submit_btn_comment").attr('disabled','disabled');	
					LoadComments(1);
					results.html('');
				}
					 

                //setInterval(updateElm(ResultsID),2000); 

            } else if (data['error_msg']) {
                results.html(data['error_msg']);
            } else {
                results.html("<div class='alert alert-danger'>" + ErrorSending + "</div>");
            }
			(formID=='profile_form' && IsCaptcha) ? GenerateCaptcha(WellColor) : GenerateCaptcha(BodyColor);
				
        }

    });

}

function downloadFile2location(id, unq) {
    window.location = "./ajax/index.php?download=" + id + "&unq=" + unq;
}

function downloadFile(id, unq , referrer) {
    $("#dowloadDiv").html(PleaseWait);
	var downloadcount = parseInt($("#downloadcountTD").html());
    $.get("ajax/index.php?download=" + id + "&unq=" + unq + "&referrer=" + referrer , function(data, status) {
        if (status == 'success'){
			$("#dowloadDiv").html(data.success_msg);
			$("#downloadcountTD").html(downloadcount+1);	
		} 
		
    });
};

function reportFile(id,reason) {
    $("#reportDiv").html(PleaseWait);
    $.get("ajax/index.php?report=" + id + "&reason=" + reason, function(data, status) {
        if (status == 'success') $("#reportDiv").html(data.success_msg);
    });
};


function deleteComment(id){
	$("#all_comment").html('<hr><code><i class="icon-spin4 animate-spin"></i> ' + PleaseWait + '<code><hr>');
    $.get("ajax/index.php?deletecomment=" + id , function(data, status) {
        if (status == 'success') 
			LoadComments(1);
    });
};


function deleteFile2(id,deleteid , title ){ 
bootbox.confirm({
    message: confirmMsg+" - <strong>"+title+"</strong> ؟",
    buttons: {confirm: {label: _Yes},cancel: {label: _No}},callback: function (Confirmed) {  
		if (Confirmed){   
		$("#deleteDiv").html('<i class="icon-spin4 animate-spin"></i> '+PleaseWait);
		$.get("ajax/index.php?delete="+deleteid+"&id="+id, function(data, status){
			if (status == 'success') 
			{
			$("#deleteDiv").html('<code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code>');
			if(data.status)
				setInterval(redirect('?download=deleteFile&confirm'), 500);
		    else
				setInterval(redirect('?download=deleteFile&notfound'), 500);
			}
		});
		}
       
    }
});
};



function confirmPasswordFile(id) {
    $("#confirmPasswordDiv").html('<code><i class="icon-spin4 animate-spin"></i> ' + PleaseWait +'</code>');
    $.get("ajax/index.php?confirm=" + id + "&password="+$('#FilePassword').val(), function(data, status) {
        if (status == 'success') {$("#confirmPasswordDiv").html(data.success_msg); if(data.status)  location.reload(); }
			
    });
};

function GetTotalPages() {
    $.get("ajax/index.php?total_pages", function(data, status) {
        if (status == 'success') return data.value;
    });
};

function showPrivacy()
{
	if(QUERY.indexOf('about') == -1 )
		redirect('?about#Tabprivacy');
	$('.nav-tabs a[href="#Tabprivacy"]').tab('show');
	$('#about3').removeClass('active');
	$('#about2').removeClass('active');
	$('#about1').addClass('active');

}

function showTerms()
{
	if(QUERY.indexOf('about') == -1 )
		redirect('?about#Tabterms');
	$('.nav-tabs a[href="#Tabterms"]').tab('show');
	$('#about1').removeClass('active');
	$('#about3').removeClass('active');
	$('#about2').addClass('active');
}

function showAbout()
{
	if(QUERY.indexOf('about') == -1 )
		redirect('?about');
	$('.nav-tabs a[href="#Tababout"]').tab('show');
	$('#about1').removeClass('active');
	$('#about2').removeClass('active');
	$('#about3').addClass('active');
}


function ExtReadMore(num) {
	$('#extensions_not_mobile').html('<code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code>'); 
	$('#extensions_mobile').html('<code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code>'); 
	    $.get("ajax/index.php?get_extensions" , function(data, status) {
        if (status == 'success'){
			$('#extensions_not_mobile').html(data.value); 
			$('#extensions_mobile').html(data.value); 
		} 
		
    });
}
function LoadComments(num) {
	var fileid = $("#comment_file_id").val() ;
    $('#cancel_comment').click();
	$("#all_comment").html('<hr><code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code><hr>');
    $.get("ajax/index.php?comments="+fileid+"&currentpage=" + num, function(data, status) {
        if (status == 'success') {
			if(data.success_msg)
				$("#all_comment").html('<hr>'+data.success_msg+'<hr>');
			else
			{
				$("#all_comment").html('');
				$('#page-selection').remove();
			}
				
			/*else
				$("#all_comment").html('<hr><code>'+data.error_msg+'</code><hr>');*/
			$('#page-selection').bootpag({total: data.success_totalpages,maxVisible: _maxVisible}).on("page", function(event, num) {
				$("#all_comment").html('<hr><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ( <code>1</code> / <code>' + data.success_totalpages + '</code> ) ...<hr>'); 
				LoadComments(num);
				});
            return data.success_totalpages;
        }
    });
};

function LoadTable(num) {
	$('#select_all').prop('checked',false);
	$('#span_select_all').hide();
	$("#button-selection").hide(); 
    $.get("ajax/index.php?files&currentpage=" + num, function(data, status) {
        if (status == 'success') {
			//data=getJsonFromString(data);
            loadTableHtml(data);
            $('#page-selection').bootpag({
                total: data.success_totalpages,
                maxVisible: _maxVisible
            });
			$('.checkbox').checkbox();
		    $('#span_select_all').show();
            return data.success_totalpages;
        }
    });
};



function deleteFile(id,deleteid,_page , title ){ 
bootbox.confirm({
    message: confirmMsg+" - <strong>"+title+"</strong> ؟",
    buttons: {confirm: {label: _Yes},cancel: {label: _No}},callback: function (Confirmed) {  
		if (Confirmed){   
		$('#FileInfosModal').modal('hide');	
		$("#tbody").html('<tr><td colspan="7"><i class="icon-spin4 animate-spin"></i> '+Loading+' ...</td></tr>');
		$.get("ajax/index.php?delete="+deleteid+"&id="+id, function(data, status){
			if (status == 'success') LoadTable(_page);
		});
		}
       
    }
});
};


function passwordFile(id, _password_, _page) {
	
	bootbox.prompt({title: PassLabel,inputType: 'password',value:_password_ , size: 'small',buttons: {confirm: {label: _Yes},cancel: {label: _No}},
    callback: function (result) {

		if(result !== null)
		{
		 $("#isPassword_"+id).html('..');
		  $.get("ajax/index.php?filepass=" + result + "&id=" + id, function(data, status) {if (status == 'success') $("#isPassword_"+id).html(data.icon);});
		$("#File_Password").val(result);
		}
    }
});	
$('#bootbox_password').password();
$('#bootbox_password').maxlength();	
}

function isPublicFile(id) {
	  $("#isPublic_"+id).html('..');
	  $.get("ajax/index.php?ispublic=" + id , function(data, status) { if (status == 'success') $("#isPublic_"+id).html(data.icon);});
		
}

function Logout() {
	
	$("#ProfileResults").html("<div class='alert alert-info'><i class='icon-spin4 animate-spin'></i> " + PleaseWait + " </div>");
    $("#LogoutResults").html("<div class='alert alert-info'><i class='icon-spin4 animate-spin'></i> " + PleaseWait + " </div>");
    $.get("ajax/index.php?logout=1", function(data, status) {
        if (status == 'success') {
            setInterval(redirect('./'), 1000);
            $('#LogoutModal').modal('hide');
        }
    });
};


window.onload = function() {

	if ( typeof(ss)!=='undefined' && IsGetEmpty )
    var 
        wrap         = document.getElementById('progressWrap'),
		access_token = 'access_token_'+HashCode,

        uploader = new ss.SimpleUpload({
        button: $('#uploadBtn') ,
        url: 'ajax/index.php?uploadfile',
		sessionProgressUrl: 'includes/sessionprogress.php',
        name: 'uploadfile',
        multipart: true,
        hoverClass: 'hover',
        focusClass: 'focus',
        maxSize: configSize, 
        queue: false,
		debug: true,
        allowedExtensions: filetypes,
        responseType: 'json',
        multiple: IsMultiple,
		multipleSelect : IsMultipleSelect,
        maxUploads: maxUploads,
		lang: Language,
        customHeaders: {
            'Authorization': access_token,
			'X-Requested-With':'XMLHttpRequest'
        },
        dropzone: 'dropzone', // ID of element to be the drop zone
        dragClass: 'upload-drop-zone drop',
        startXHR: function() {},
        onSubmit: function(filename, ext) {
            var prog = document.createElement('div'),
                outer = document.createElement('div'),
                bar = document.createElement('div'),
                size = document.createElement('div'),
				abort = document.createElement('a'),
                self = this;
				self.setData({ code : HashCode, passwordfile : $("#File_Password").val() , ispublic : $("#isPublic").prop( "checked" ) ? 1 : 0 });
			
			
            prog.className = 'prog';
            size.className = 'size';
            outer.className = 'progress progress-striped';
            bar.className = 'progress-bar progress-bar-success';
			abort.className = 'badge pull-'+directionDiv;
			abort.href = "javascript:void(0)";
			abort.innerHTML  = _No ;
			 // Dynamically add a "Cancel" button to be displayed when upload begins
        // By doing it here ensures that it will only be added in browses which
        // support cancelling uploads
      
        
        
        
        // Adds click event listener that will cancel the upload
        // The second argument is whether the button should be removed after the upload
        // true = yes, remove abort button after upload
        // false/default = do not remove
          
			
            outer.appendChild(bar);
            prog.appendChild(size);
			prog.appendChild(abort);
            prog.appendChild(outer);
            wrap.appendChild(prog); // 'wrap' is an element on the page
            
			
            self.setProgressBar(bar);
            self.setProgressContainer(prog);
            self.setFileSizeBox(size);
			self.setAbortBtn(abort, true);
			//self.disable();
			
			$('#upresult').show();
            $('#wrap').show();
			$('#progressWrap').show();
            $('#dragLabel').hide();
			//$('#uploadLabel').hide();
			$('#uploadLabel').html( UploadingMsg );
		    $('#uploadIcon').html('<i class="icon-spin6 animate-spin uploadIcon"></i>');
			$("#queue").html( queueLabel +' : <code>'+self.getQueueSize()+'</code>' );
			
			if(IsStatsPanel)
				{
				$("#StatsPanel").html('<i class="icon-spin4 animate-spin"></i> '+Loading + ' ...' ); 
				$('#collapseStats').removeClass().addClass('panel-collapse collapse in');
				$('#collapseOne').removeClass().addClass('panel-collapse collapse');
				}
        },
        onSizeError: function( filename, fileSize ) {
            ShowMessage(ErrorSzMsg);	
        },
		onAbort: function( filename, uploadBtn, size )
		{
		    ShowMessage(ErrorAborted);	
		},
        onExtError: function( filename, extension ) {
            ShowMessage(ExtErrMsg);
        },
		onProgress: function( pct ){
			/*$('#'+progressId).html( pct+'%');*/
		},
		onAllDone: function(){
				
			UploadOnComplete();
			
			if(this._queue.length === 0 && this._active === 0 )
			{
				$('html, body').animate({scrollTop: $("#file_"+FilesTotal).offset().top}, 2000);
				//this.enable();
			}
			

		},
		onDone: function( filename, status, textStatus, response, uploadBtn, size ) {
			
		},
        onComplete: function(filename, response, uploadBtn, size ) {
			//$("#dropzone").css('position','relative');
			 //alert(JSON.stringify(   response  ));
            if (response && IsStatsPanel)
				{
					
				$("#StatsPanel").html(response.StatsPanel); 
				$('#collapseStats').removeClass().addClass('panel-collapse collapse in');
				$('#collapseOne').removeClass().addClass('panel-collapse collapse');
				
				}
                

            if (!response) {
                $("#msgBox").append(showError(UnableMsg));
                return;
            }

			
            if (response.success === true) {
				
				FilesTotal++;
				
                $("#msgBox").append('<li id="file_'+FilesTotal+'" data-file-num="'+FilesTotal+'" data-file-orgname="'+escapeTags(filename)+'" data-file-id="'+response.ID+'" data-file-cryptid="'+response.cryptID+'"  data-file-name="'+response.UploadDir +'/'+ response.FileName+'" data-file-deleteid="'+response.DeleteId+'" data-file-downloadid="'+response.DownloadId+'"  data-file-thumbnaildir="'+response.ThumbnailDir+'"  class="list-group-item list-group-item-success"><span class="badge alert-success hidden-xs">' + UploadedMsg + '</span>' +
                    '<a href="javascript:void(0)"  onclick="ShowLinks(' +FilesTotal+ ')"><i class="' +response.Icon+' colorIcon"></i> '+ escapeTags(filename) + '</a>' +
                    '</li>');

            } else {
                    $("#msgBox").append( (response.msg) ? showError(response.msg) : showError(ErrorHMsg) ) ; 
                
            }
        },
        onError: function(filename, type, status, statusText, response, uploadBtn, size) {
		      ShowMessage(UnableMsg);
        }
    });
};


 
 /*
$('#LoginModal').on('hidden.bs.modal', function() {$("#container").show() });
$('#RegisterModal').on('hidden.bs.modal', function() {$("#container").show() });
$('.modal-dialog').draggable({cursor: 'move',handle: '.modal-header'});
$('.modal-dialog>.modal-content>.modal-header').css('cursor', 'move');
*/
 if(IsAnimated)
 {
	// SetModalAnimation('LoginModal','flipInX','wobble','modal-sm');
	// SetModalAnimation('RegisterModal','rotateIn','fadeOut','modal-sm');
    // SetModalAnimation('AboutModal','jello','bounceOut','modal-md');
    // SetModalAnimation('ProfileModal','rubberBand','bounceOut','modal-sm');
    // SetModalAnimation('FilesModal','pulse','bounceOut');
    // SetModalAnimation('ShowLinks','headShake','bounceOut'); 
 }
 
 if(IsGetDownload)
{
	LoadComments(1);	
}
 
   function StatsFile(id,filename) {
	   
	    $('#StatsModal').modal('show');
		$('.nav-tabs a[href="#Countrie"]').tab('show');
		$('#Statfilename').html(escapeTags(filename));
        $("#Countries").html('<tr><td colspan="3"><code><i class="icon-spin4 animate-spin"></i>' + Loading + ' ...</code></td></tr>');
		$("#Browsers").html('<tr><td colspan="3"><code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code></td></tr>');
		$("#Platforms").html('<tr><td colspan="3"><code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code></td></tr>');
		$("#Referrers").html('<tr><td colspan="3"><code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code></td></tr>');
		$("#Dates").html('<tr><td colspan="3"><code><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ...</code></td></tr>');
	
		
        $.get("ajax/index.php?stats&id="+id, function(data, status) {
            if (status == 'success') {
				
				
				$("#Countries").html(data.countries.table);
				$("#Browsers").html(data.browsers.table);
				$("#Platforms").html(data.platforms.table);
				$("#Referrers").html(data.referrers.table);
				$("#Dates").html(data.dates.table);
								
			
				pieChart("#ChartPlatforms",data.platforms.labels,data.platforms.data);
				pieChart("#ChartCountries",data.countries.labels,data.countries.data);
				pieChart("#ChartBrowsers",data.browsers.labels,data.browsers.data);
				barChart("#ChartReferrers",data.referrers.labels,data.referrers.data,RefLabel);
			    barChart("#ChartDates",data.dates.labels,data.dates.data,DateLbl);	
				
                $('#page-selection_1').bootpag({page: 1,total: data.countries.count,maxVisible: _maxVisible}).on("page", function(event, num) {LoadStatsTables(num,id,'countries');});
				$('#page-selection_2').bootpag({page: 1,total: data.browsers.count,maxVisible: _maxVisible}).on("page", function(event, num) {LoadStatsTables(num,id,'browsers');});
				$('#page-selection_3').bootpag({page: 1,total: data.platforms.count,maxVisible: _maxVisible}).on("page", function(event, num) {LoadStatsTables(num,id,'platforms');});
				$('#page-selection_4').bootpag({page: 1,total: data.referrers.count,maxVisible: _maxVisible}).on("page", function(event, num) {LoadStatsTables(num,id,'referrers');});
				$('#page-selection_5').bootpag({page: 1,total: data.dates.count,maxVisible: _maxVisible}).on("page", function(event, num) {LoadStatsTables(num,id,'dates');});

            }
        });

    };
 
 
//SetModalAnimation(_Modal,_Entrance,_Exit,_ModalSize='')

if (IsLogin) {

if(IsGetFiles)
	GetFiles();
if(IsGetProfile)
{
	GetProfile();
	GetStatsDates();
}
	




  function GetProfile() {
	  IsCaptcha ? GenerateCaptcha(WellColor,FontColor) : '';
	  $("#progressUsed").html( Loading + ' ...');
	  $("#progressFree").html( Loading + ' ...'); 
	     $.get("ajax/index.php?get_space", function(data, status) {
            if (status == 'success') {
				$("#progressUsed").css('width', data.used+'%').attr('aria-valuenow', data.used); 	
				$("#progressFree").css('width', data.free+'%').attr('aria-valuenow', data.free); 	
				$("#progressUsed").html( data.used+'%');
				$("#progressFree").html( data.free+'%'); 

            }
        });
	  	  
   };
   

     function GetFiles() 
    {
        $("#tbody").html('<tr><td colspan="7"><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ( <code>1</code> / <code>' + totalpages + '</code> ) ...</td></tr>');
         LoadTable(1);		
	};
	
	if(IsGetFiles)
	{
	LoadJsCheckbox = true;
    $('#page-selection').bootpag({
        page: currentpage,
        total: totalpages,
        maxVisible: _maxVisible
    }).on("page", function(event, num) {
        $("#tbody").html('<tr><td colspan="7"><i class="icon-spin4 animate-spin"></i> ' + Loading + ' ( <code>' + num + '</code> / <code>' + totalpages + '</code> ) ...</td></tr>');
        LoadTable(num);
    });
	
	}
   

}

/*----------------- checkboxes ---------------*/

function confirm_request(parameter,ResultsID,formID) {
	var results  = $("#"+ResultsID);
	 bootbox.confirm({
    message: confirmMsg+" - <strong> "+Numberlbl+" : "+TotalItems()+" </strong> ؟",
    buttons: {confirm: {label: _Yes},cancel: {label: _No}},callback: function (Confirmed) {  
		if (Confirmed){   
	$.ajax({
           type: "POST",
           url: 'ajax/index.php?'+parameter,
           dataType: "json",
		   data: $("#"+formID).serialize(),
          beforeSend: function() {
			  $("#result-selection").show(); 
			  results.html("<code><i class='icon-spin4 animate-spin'></i> "+PleaseWait+"</code>");	
			  },
           success: function (data) {
               if(data['success_msg']) {
				
					results.html(""); 
					tr = data.success_msg;
					
					 for (var i=0; i< tr.length ; i++ ) 
						 $( "#file_"+tr[i] ).hide();
					 
				    $('#page-selection').bootpag({ total: data.success_totalpages ,maxVisible: _maxVisible}); 
					$("#button_1").html(deleteLabel);
					
					$("#button-selection").hide(); 
					$("#result-selection").hide(); 
					
					if(tr.length==rowsperpage )
						LoadTable(1);
					

				$("#"+formID).trigger("reset");
			   } else if(data['error_msg']) {
				results.html(data.error_msg);
			   } else {
				results.html("<code>"+ErrorSending+"</code>");
			   }			   
           }
		   
    });
	
}

}
});
}	
		